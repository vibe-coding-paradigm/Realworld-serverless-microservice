#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Backend build verification
echo "ğŸ¹ Verifying backend build..."
if [ -d "backend" ]; then
  (
    cd backend
    
    echo "  ğŸ”¨ Building backend..."
    if go build ./cmd/...; then
      echo "  âœ… Backend build successful"
      # Clean up build artifacts
      rm -f server migrate
    else
      echo "  âŒ Backend build failed"
      exit 1
    fi
  ) || exit 1
fi

# Frontend test verification
echo "ğŸ§ª Running frontend tests..."
if [ -d "frontend" ]; then
  (
    cd frontend
    
    echo "  ğŸ” Running frontend tests..."
    if npm run test:run; then
      echo "  âœ… Frontend tests passed"
    else
      echo "  âŒ Frontend tests failed"
      exit 1
    fi
  ) || exit 1
fi

# Frontend build verification
echo "ğŸŒ Verifying frontend build..."
if [ -d "frontend" ]; then
  (
    cd frontend
    
    echo "  ğŸ”¨ Building frontend..."
    if npm run build; then
      echo "  âœ… Frontend build successful"
    else
      echo "  âŒ Frontend build failed"
      exit 1
    fi
  ) || exit 1
fi

echo "âœ… All pre-push checks passed!"