# GitHub Repository Variables Configuration

This document describes the required GitHub repository variables for the CI/CD workflows.

## Required Variables

Set these variables in your GitHub repository settings under `Settings > Secrets and variables > Actions > Variables`.

### Required Variables

| Variable Name | Description | Example Value |
|---------------|-------------|---------------|
| `AWS_REGION` | AWS region for deployment | `ap-northeast-2` |
| `ECS_CLUSTER` | ECS cluster name | `conduit-cluster` |
| `ECS_SERVICE` | ECS service name | `conduit-backend` |
| `ECR_REPOSITORY` | ECR repository name | `conduit-backend` |

### Dynamically Generated URLs

The following URLs are **automatically generated** by the workflows and do not need to be set manually:

- **BACKEND_URL**: Dynamically retrieved from ALB DNS name during deployment
- **FRONTEND_URL**: Automatically generated by GitHub Pages deployment

## Required Secrets

| Secret Name | Description |
|-------------|-------------|
| `AWS_ROLE_ARN` | AWS IAM role ARN for GitHub Actions OIDC |

## How to Set Variables

1. Go to your GitHub repository
2. Click on `Settings` tab
3. In the left sidebar, click on `Secrets and variables` > `Actions`
4. Click on the `Variables` tab
5. Click `New repository variable`
6. Add each variable from the table above

Or use GitHub CLI:
```bash
gh variable set AWS_REGION --body "ap-northeast-2"
gh variable set ECS_CLUSTER --body "conduit-cluster"
gh variable set ECS_SERVICE --body "conduit-backend"
gh variable set ECR_REPOSITORY --body "conduit-backend"
```

## Workflow Behavior

- **Frontend Deploy**: 
  - Dynamically retrieves ALB DNS name for backend URL
  - Uses GitHub Pages deployment URL for frontend URL
  - Passes both URLs to E2E tests

- **Backend Deploy**: 
  - Requires all AWS-related variables
  - Dynamically retrieves ALB DNS name after deployment
  - Passes backend URL to E2E tests

- **E2E Tests**: 
  - Receives backend_url and frontend_url as required inputs from parent workflows
  - Validates both URLs are provided

- **Load Tests**: 
  - Can accept manual backend_url input
  - Falls back to dynamic ALB DNS discovery if no input provided
  - Requires AWS credentials if using dynamic discovery

## Error Handling

If any required variable is missing or URLs cannot be dynamically retrieved, the workflow will:
1. Display a clear error message
2. Exit with status code 1
3. Prevent deployment with incomplete configuration

This ensures all deployments use proper configuration management and dynamic URL discovery.